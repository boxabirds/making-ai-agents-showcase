# Task 4: read_file Tool (Basic)

## Objective
Implement the basic `read_file` tool that reads and caches file content.

## Dependencies
- Task 3: list_files tool

## Deliverables

`tech_writer/tools/filesystem.py`:

```python
def read_file(
    path: str,
    start_line: int = None,
    end_line: int = None,
    store: Store = None
) -> str:
    """
    Read a file's contents and cache it.

    Args:
        path: File path relative to repo root
        start_line: Optional start line (1-indexed)
        end_line: Optional end line (inclusive)
        store: Cache store (if None, no caching)

    Returns:
        File content (or specified line range)

    Side effects:
        - Caches full content in store (even if line range requested)
        - Detects language from extension
    """
```

## Acceptance Criteria

- [ ] Reads file content as UTF-8
- [ ] Handles encoding errors gracefully (replace invalid chars)
- [ ] Supports line range extraction (1-indexed)
- [ ] Caches full content in store on first read
- [ ] Returns cached content on subsequent reads
- [ ] Detects language from file extension
- [ ] Raises clear error for non-existent files

## Test Cases (using axios repo)

```gherkin
Feature: read_file tool

  Scenario: Read entire file
    Given the axios repository is cloned
    When I call read_file("package.json")
    Then the result should contain "axios"
    And the file should be cached in the store

  Scenario: Read line range
    Given the axios repository is cloned
    When I call read_file("package.json", start_line=1, end_line=5)
    Then the result should have 5 lines
    And the full file should still be cached

  Scenario: Cached read
    Given the axios repository is cloned
    And I have already called read_file("package.json")
    When I call read_file("package.json") again
    Then the result should come from cache
    And no file system read should occur

  Scenario: Non-existent file
    Given the axios repository is cloned
    When I call read_file("does-not-exist.txt")
    Then an error should be raised with a clear message
```

## Language Detection

```python
LANG_MAP = {
    ".py": "python",
    ".js": "javascript",
    ".mjs": "javascript",
    ".ts": "typescript",
    ".tsx": "tsx",
    ".jsx": "javascript",
    ".json": "json",
    ".md": "markdown",
    ".yaml": "yaml",
    ".yml": "yaml",
    # ... etc
}
```

## Implementation Notes

- Always cache full file even when line range requested (for citation verification)
- Line numbers are 1-indexed (human convention)
- Use `binaryornot` to skip binary files
