# Task 19: Citation Parsing

## Objective
Parse citations from generated report content.

## Dependencies
- Task 4: read_file tool

## Deliverables

`tech_writer/citations.py`:

```python
import re
from dataclasses import dataclass

@dataclass
class Citation:
    path: str
    start_line: int
    end_line: int
    raw: str  # Original citation string

CITATION_PATTERN = re.compile(r'\[([^:\]]+):(\d+)-(\d+)\]')

def parse_citation(citation_str: str) -> Citation:
    """
    Parse a single citation string.

    Args:
        citation_str: Citation like "src/main.py:10-25"

    Returns:
        Citation object

    Raises:
        ValueError: If format is invalid
    """

def extract_citations(content: str) -> list[Citation]:
    """
    Extract all citations from markdown content.

    Args:
        content: Markdown text with [path:line-line] citations

    Returns:
        List of Citation objects (may contain duplicates)
    """
```

## Acceptance Criteria

- [ ] Parses `path:start-end` format
- [ ] Handles various path formats (relative, nested)
- [ ] Extracts all citations from text
- [ ] Preserves original citation string
- [ ] Raises clear error for malformed citations
- [ ] Handles paths with special characters

## Test Cases

```gherkin
Feature: Citation parsing

  Scenario: Parse simple citation
    Given citation string "src/main.py:10-25"
    When I parse it
    Then path should be "src/main.py"
    And start_line should be 10
    And end_line should be 25

  Scenario: Parse nested path
    Given citation string "lib/core/Axios.js:100-150"
    When I parse it
    Then path should be "lib/core/Axios.js"

  Scenario: Extract from markdown
    Given markdown content:
      """
      The main class [lib/axios.js:10-20] provides
      methods for requests [lib/axios.js:30-40].
      """
    When I extract citations
    Then I should find 2 citations

  Scenario: Invalid format
    Given citation string "invalid"
    When I try to parse it
    Then a ValueError should be raised

  Scenario: Path with spaces (edge case)
    Given citation string "my file.js:1-10"
    When I parse it
    Then it should handle the space correctly
```

## Edge Cases

```python
# Valid citations
"src/main.py:1-1"           # Single line
"src/main.py:1-1000"        # Large range
"a.py:10-20"                # Short path
"src/sub/deep/file.ts:5-10" # Deep nesting

# Invalid citations (should raise)
"src/main.py:10"            # Missing end line
"src/main.py:10-"           # Incomplete
"src/main.py:-20"           # Missing start
"src/main.py:abc-def"       # Non-numeric
":10-20"                    # Missing path
```

## Implementation Notes

- Use regex for extraction
- Line numbers are 1-indexed (human convention)
- Store raw string for error reporting
- Consider citations inside code blocks (should still extract)
