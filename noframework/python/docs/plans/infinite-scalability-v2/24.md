# Task 24: BDD Test Framework Setup

## Objective
Set up Behavior-Driven Development testing infrastructure using pytest-bdd.

## Dependencies
- Task 1: Project scaffolding

## Deliverables

```
tests/
├── conftest.py           # Shared fixtures
├── features/
│   ├── exploration.feature
│   ├── semantic.feature
│   ├── outline.feature
│   ├── sections.feature
│   ├── citations.feature
│   └── e2e.feature
└── step_defs/
    ├── __init__.py
    ├── common_steps.py
    ├── exploration_steps.py
    ├── semantic_steps.py
    └── ...
```

`pyproject.toml` additions:
```toml
[project.optional-dependencies]
test = [
    "pytest>=7.0",
    "pytest-bdd>=6.0",
]
```

## Acceptance Criteria

- [ ] pytest-bdd installed and configured
- [ ] Feature files directory structure created
- [ ] conftest.py with shared fixtures
- [ ] `pytest tests/` runs without errors
- [ ] Sample feature file parses correctly

## conftest.py

```python
import pytest
import tempfile
from pathlib import Path
from tech_writer.store import Store

@pytest.fixture
def store():
    """In-memory store for testing."""
    return Store(":memory:")

@pytest.fixture
def temp_dir():
    """Temporary directory for test files."""
    with tempfile.TemporaryDirectory() as d:
        yield Path(d)

@pytest.fixture
def axios_repo(temp_dir):
    """
    Clone axios repo for integration tests.
    Uses shallow clone for speed.
    """
    from tech_writer.repo import clone_repo
    return clone_repo("https://github.com/axios/axios", temp_dir)

@pytest.fixture
def sample_python_file(temp_dir):
    """Create a sample Python file for testing."""
    content = '''
class Foo:
    """A sample class."""
    def bar(self, x: int) -> str:
        """A sample method."""
        return str(x)

def baz():
    """A sample function."""
    pass
'''
    path = temp_dir / "sample.py"
    path.write_text(content)
    return path
```

## Sample Feature File

```gherkin
# tests/features/sample.feature
Feature: Sample feature to verify setup

  Scenario: Framework is working
    Given a test store
    When I add a file to the store
    Then the file should be retrievable
```

## Test Cases

```gherkin
Feature: BDD framework setup

  Scenario: Run pytest
    When I run: pytest tests/ -v
    Then tests should execute
    And no import errors should occur

  Scenario: Feature files discovered
    When I run: pytest tests/ --collect-only
    Then feature files should be listed
    And scenarios should be collected
```

## Implementation Notes

- Use pytest-bdd for Gherkin support
- Fixtures manage test state
- axios_repo fixture is slow; mark related tests appropriately
- Consider pytest markers for slow tests: `@pytest.mark.slow`
