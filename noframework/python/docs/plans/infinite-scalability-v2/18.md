# Task 18: Section Generation (Agentic)

## Objective
Generate each report section with agentic exploration capability.

## Dependencies
- Task 17: Outline generation

## Deliverables

`tech_writer/orchestrator.py` (additions):

```python
class SectionGenerator:
    def __init__(
        self,
        store: Store,
        repo_root: Path,
        llm_client,
        max_exploration_steps: int = 5
    ):
        ...

    def generate(
        self,
        section: Section,
        prompt: str,
        previous_sections: list[str] = None
    ) -> str:
        """
        Generate content for a single section.

        Args:
            section: Section to generate
            prompt: User's original request
            previous_sections: Already-generated sections (for context)

        Returns:
            Markdown content for this section
        """
```

## Acceptance Criteria

- [ ] Generates markdown content for section
- [ ] Can call tools for additional exploration
- [ ] Must include citations in [path:line-line] format
- [ ] Respects section focus
- [ ] Limited exploration steps per section
- [ ] Content is coherent with previous sections

## System Prompt for Section

```
Write the "{section.title}" section of a technical report.

Focus: {section.focus}

User's original request: {prompt}

Previously written sections (for context):
{previous_sections_summary}

Available evidence (from files you've read):
{evidence_from_relevant_files}

You have tools available if you need more information:
- read_file: Read additional files
- get_symbols: See functions/classes
- get_structure: Get file overview
- search_text: Find specific content

Rules:
1. Every factual statement must cite evidence using [path:start-end] format
2. Citations must reference files that have been read
3. Do not invent facts - only cite what you can see
4. Output the section content in markdown
5. When done writing, stop calling tools and output the content
```

## Test Cases (using axios repo)

```gherkin
Feature: Section generation

  Scenario: Generate section with citations
    Given outline section "Core Axios Class"
    And relevant files have been read
    When I generate the section
    Then the content should include citations
    And citations should be in [path:line-line] format

  Scenario: Additional exploration
    Given outline section needs more detail
    And relevant_files don't cover everything
    When I generate the section
    Then the LLM may call read_file for more info
    And new files should be cached

  Scenario: Section coherence
    Given previous section discussed "Overview"
    When I generate "Core Axios Class" section
    Then content should not repeat overview
    And should reference it appropriately
```

## Output Format

```markdown
## Core Axios Class

The main Axios class is defined in `lib/core/Axios.js` and serves as the
foundation for all HTTP requests [lib/core/Axios.js:15-20].

### Constructor

The constructor accepts a configuration object that sets defaults for all
requests [lib/core/Axios.js:25-35]:

- `baseURL`: Base URL for requests
- `timeout`: Request timeout in milliseconds
- `headers`: Default headers

### Methods

The class provides methods for each HTTP verb [lib/core/Axios.js:40-80]:

- `request(config)`: Generic request method
- `get(url, config)`: GET request
- `post(url, data, config)`: POST request
```

## Implementation Notes

- Similar agentic loop as exploration, but shorter (max 5 steps)
- Pre-populate context with relevant file content
- Track which citations are used
- Section generator can read new files (adds to cache)
- Output is final when LLM responds without tool calls
