# Task 16: finish_exploration Handling

## Objective
Implement the `finish_exploration` tool and state transition.

## Dependencies
- Task 15: Exploration orchestration

## Deliverables

`tech_writer/tools/control.py`:

```python
class ExplorationState:
    """Shared state for exploration control."""
    complete: bool = False
    understanding: str = ""

def finish_exploration(understanding: str, state: ExplorationState) -> str:
    """
    Signal that exploration is complete.

    Args:
        understanding: Brief summary of what was learned

    Returns:
        Confirmation message
    """
    state.complete = True
    state.understanding = understanding
    return f"Exploration complete. Proceeding to outline generation."
```

## Acceptance Criteria

- [ ] `finish_exploration` sets completion flag
- [ ] Understanding summary is captured
- [ ] Orchestrator detects completion and exits loop
- [ ] Understanding is passed to outline phase
- [ ] Tool returns confirmation message

## Test Cases

```gherkin
Feature: finish_exploration handling

  Scenario: Explicit completion
    Given an exploration in progress
    When the LLM calls finish_exploration("Found 3 main modules")
    Then exploration should be marked complete
    And understanding should be "Found 3 main modules"

  Scenario: State transition
    Given exploration is complete
    When I access the orchestrator state
    Then exploration_complete should be True
    And understanding should be available

  Scenario: Confirmation returned
    When I call finish_exploration("Summary here")
    Then the return value should confirm completion
```

## State Management

```python
# In orchestrator.py

def run(self, prompt: str) -> str:
    state = ExplorationState()

    # Bind state to finish_exploration tool
    tools = self._bind_tools(state)

    for step in range(self.max_steps):
        message = self._call_llm()

        if message.tool_calls:
            for tool_call in message.tool_calls:
                result = self._execute_tool(tool_call, state)
                self._add_tool_result(tool_call.id, result)

        if state.complete:
            return state.understanding

    raise MaxStepsExceeded(f"Exploration did not complete in {self.max_steps} steps")
```

## Implementation Notes

- State object passed to tool execution context
- Only `finish_exploration` modifies the state
- Orchestrator checks state after each tool execution
- Understanding captured for next phase
