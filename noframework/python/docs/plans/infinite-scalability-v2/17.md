# Task 17: Outline Generation

## Objective
Generate report outline based on exploration results.

## Dependencies
- Task 16: finish_exploration handling

## Deliverables

`tech_writer/orchestrator.py` (additions):

```python
@dataclass
class Section:
    title: str
    focus: str
    relevant_files: list[str]

def generate_outline(
    prompt: str,
    understanding: str,
    cached_files: list[str],
    llm_client
) -> list[Section]:
    """
    Generate report outline.

    Args:
        prompt: User's original request
        understanding: Summary from exploration
        cached_files: List of files that were read
        llm_client: LLM client for generation

    Returns:
        List of sections to generate
    """
```

## Acceptance Criteria

- [ ] Returns list of Section objects
- [ ] Each section has title, focus, relevant_files
- [ ] Outline is based on exploration understanding
- [ ] Number of sections is reasonable (3-15 typical)
- [ ] Sections are coherent with prompt request

## Prompt Template

```
Based on your exploration of the codebase, create an outline for the report.

User's request:
{prompt}

Files you explored:
{cached_files}

Your understanding:
{understanding}

Create an outline as a JSON array. Each section should have:
- title: Section heading
- focus: What this section should cover (1-2 sentences)
- relevant_files: Files that contain information for this section

Output ONLY the JSON array, no other text:
[
  {"title": "...", "focus": "...", "relevant_files": ["..."]},
  ...
]
```

## Test Cases (using axios repo)

```gherkin
Feature: Outline generation

  Scenario: Generate outline for architecture doc
    Given exploration of axios is complete
    And prompt is "Write architectural overview"
    When I generate outline
    Then I should get 5-10 sections
    And sections should cover core components

  Scenario: Sections reference explored files
    Given exploration read ["lib/axios.js", "lib/core/Axios.js"]
    When I generate outline
    Then relevant_files should only contain explored files

  Scenario: JSON parsing
    When outline is generated
    Then it should parse as valid JSON
    And each section should have required fields
```

## Output Format

```python
[
    Section(
        title="Overview",
        focus="High-level architecture and main entry points",
        relevant_files=["lib/axios.js", "README.md"]
    ),
    Section(
        title="Core Axios Class",
        focus="The main Axios class and its configuration",
        relevant_files=["lib/core/Axios.js"]
    ),
    Section(
        title="Request Handling",
        focus="How requests are dispatched and transformed",
        relevant_files=["lib/core/dispatchRequest.js"]
    )
]
```

## Implementation Notes

- Single LLM call (no tools needed)
- Parse JSON from response
- Validate section structure
- Handle malformed JSON gracefully (retry once)
- Filter relevant_files to only include actually-cached files
