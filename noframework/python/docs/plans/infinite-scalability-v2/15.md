# Task 15: Exploration Orchestration

## Objective
Implement the exploration loop where the LLM calls tools to understand the codebase.

## Dependencies
- Task 14: Tool registration

## Deliverables

`tech_writer/orchestrator.py`:

```python
class ExplorationOrchestrator:
    def __init__(
        self,
        store: Store,
        repo_root: Path,
        llm_client,
        max_steps: int = 50
    ):
        self.store = store
        self.repo_root = repo_root
        self.client = llm_client
        self.max_steps = max_steps
        self.tools = get_tool_definitions()
        self.memory = []
        self.exploration_complete = False
        self.understanding = None

    def run(self, prompt: str) -> str:
        """
        Run exploration loop until LLM calls finish_exploration.

        Returns:
            The understanding summary from finish_exploration
        """

    def _execute_tool(self, tool_call) -> str:
        """Execute a tool call and return result."""

    def _call_llm(self) -> Message:
        """Call LLM with current memory and tools."""
```

## Acceptance Criteria

- [ ] LLM can call tools repeatedly
- [ ] Tool results are added to memory
- [ ] Loop terminates on `finish_exploration`
- [ ] Loop terminates on max_steps with warning
- [ ] Memory tracks full conversation
- [ ] Errors in tools are reported gracefully

## System Prompt

```
You are exploring a codebase to write documentation.

Use the available tools to understand the codebase structure:
- list_files: See what files exist
- read_file: Read file contents
- get_symbols: See functions/classes in a file
- get_imports: See dependencies
- get_definition: Find where something is defined
- get_references: Find where something is used
- get_structure: Get overview of a file
- search_text: Search for strings/comments

When you understand enough to write the requested documentation,
call finish_exploration with a summary of what you learned.

User's request: {prompt}

Repository root: {repo_root}
```

## Test Cases (using axios repo)

```gherkin
Feature: Exploration orchestration

  Scenario: Basic exploration
    Given the axios repository is cloned
    And a prompt "Explain the main axios API"
    When I run exploration
    Then the LLM should call list_files
    And the LLM should call read_file at least once
    And exploration should end with finish_exploration

  Scenario: Max steps limit
    Given the axios repository is cloned
    And a prompt that requires extensive exploration
    And max_steps=5
    When I run exploration
    Then exploration should stop at 5 steps
    And a warning should be logged

  Scenario: Tool errors handled
    Given the axios repository is cloned
    When the LLM calls read_file("nonexistent.txt")
    Then an error message should be returned
    And exploration should continue
```

## Implementation Notes

- Similar structure to existing `TechWriterReActAgent.run()`
- Use OpenAI function calling format
- Parse tool calls from assistant message
- Execute tools and append results to memory
- Check for `finish_exploration` to end loop
