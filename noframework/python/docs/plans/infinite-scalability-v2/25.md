# Task 25: Feature: Exploration Tools

## Objective
BDD tests for file system and exploration tools.

## Dependencies
- Task 24: BDD test framework setup
- Task 14: Tool registration

## Deliverables

`tests/features/exploration.feature`:

```gherkin
Feature: Exploration tools
  As a tech writer agent
  I need to explore codebases
  So that I can understand their structure

  Background:
    Given the axios repository is available

  # list_files tests

  Scenario: List all files
    When I call list_files("*")
    Then I should get a list of file paths
    And the list should include "package.json"

  Scenario: List by extension
    When I call list_files("*.js")
    Then all results should end with ".js"
    And "package.json" should not be in results

  Scenario: List in subdirectory
    When I call list_files("*.js", path="lib")
    Then all results should start with "lib/"

  Scenario: Recursive glob
    When I call list_files("**/*.js")
    Then results should include files from nested directories

  Scenario: Respect gitignore
    When I call list_files("**/*")
    Then results should not include "node_modules/" files

  # read_file tests

  Scenario: Read entire file
    When I call read_file("package.json")
    Then I should get the file contents
    And contents should include "axios"

  Scenario: Read line range
    When I call read_file("package.json", start_line=1, end_line=5)
    Then I should get exactly 5 lines

  Scenario: File is cached after read
    When I call read_file("package.json")
    Then the file should be in the store cache

  Scenario: Cached read is fast
    Given I have already read "package.json"
    When I call read_file("package.json") again
    Then the result should come from cache

  Scenario: Non-existent file
    When I call read_file("does-not-exist.txt")
    Then I should get an error
    And the error should mention "not found"
```

## Step Definitions

`tests/step_defs/exploration_steps.py`:

```python
from pytest_bdd import given, when, then, parsers
from tech_writer.tools.filesystem import list_files, read_file

@given("the axios repository is available")
def axios_available(axios_repo):
    return axios_repo

@when(parsers.parse('I call list_files("{pattern}")'))
def call_list_files(pattern, axios_repo, context):
    context["result"] = list_files(pattern, repo_root=axios_repo)

@when(parsers.parse('I call list_files("{pattern}", path="{path}")'))
def call_list_files_with_path(pattern, path, axios_repo, context):
    context["result"] = list_files(pattern, path=path, repo_root=axios_repo)

@then("I should get a list of file paths")
def check_list_result(context):
    assert isinstance(context["result"], list)
    assert len(context["result"]) > 0

@then(parsers.parse('the list should include "{filename}"'))
def check_list_includes(filename, context):
    assert filename in context["result"]

@then(parsers.parse('all results should end with "{suffix}"'))
def check_all_end_with(suffix, context):
    for f in context["result"]:
        assert f.endswith(suffix), f"{f} doesn't end with {suffix}"
```

## Test Cases Summary

| Tool | Scenario | Expected |
|------|----------|----------|
| list_files | Basic glob | Returns matching files |
| list_files | Extension filter | Only matching extensions |
| list_files | Subdirectory | Paths prefixed correctly |
| list_files | Recursive | Finds nested files |
| list_files | Gitignore | Excludes ignored files |
| read_file | Full file | Returns content |
| read_file | Line range | Returns specified lines |
| read_file | Caching | File stored after read |
| read_file | Cache hit | Second read from cache |
| read_file | Not found | Clear error message |

## Implementation Notes

- Use `context` dict fixture for passing data between steps
- axios_repo fixture handles cloning
- Mark slow tests with `@pytest.mark.slow`
