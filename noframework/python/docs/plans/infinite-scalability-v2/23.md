# Task 23: Remote Repository Cloning

## Objective
Support cloning remote repositories for analysis.

## Dependencies
- Task 22: CLI implementation

## Deliverables

`tech_writer/repo.py`:

```python
from pathlib import Path
import tempfile

DEFAULT_CACHE_DIR = "~/.cache/github"

def resolve_repo(repo_arg: str, cache_dir: str = DEFAULT_CACHE_DIR) -> tuple[Path, bool]:
    """
    Resolve repository argument to local path.

    Args:
        repo_arg: Local path or remote URL
        cache_dir: Directory for cloned repos (default: ~/.cache/github)

    Returns:
        (local_path, is_temporary)
        is_temporary=True means caller should clean up
    """

def is_remote_url(repo_arg: str) -> bool:
    """Check if argument is a remote URL."""

def clone_repo(url: str, target_dir: Path) -> Path:
    """
    Clone a git repository.

    Args:
        url: Repository URL
        target_dir: Directory to clone into

    Returns:
        Path to cloned repository
    """

def cleanup_repo(path: Path) -> None:
    """Remove a temporary cloned repository."""
```

## Acceptance Criteria

- [ ] Detects remote URLs (https, git@)
- [ ] Clones to `~/.cache/github/{repo_name}` by default
- [ ] Reuses cached clone if already exists
- [ ] Supports custom cache directory via CLI arg
- [ ] Handles clone failures gracefully
- [ ] Works with GitHub, GitLab, Bitbucket URLs

## Supported URL Formats

```python
# HTTPS
"https://github.com/axios/axios"
"https://github.com/axios/axios.git"
"https://gitlab.com/user/repo"

# SSH (less common for this use case)
"git@github.com:axios/axios.git"

# Local paths (not URLs)
"/path/to/repo"
"./relative/path"
"~/home/path"
```

## Test Cases

```gherkin
Feature: Remote repository cloning

  Scenario: Clone GitHub repo
    Given URL "https://github.com/axios/axios"
    When I resolve the repo
    Then the repo should be cloned
    And local_path should point to cloned directory
    And is_temporary should be True

  Scenario: Local path passthrough
    Given path "/local/project"
    When I resolve the repo
    Then local_path should be "/local/project"
    And is_temporary should be False
    And no cloning should occur

  Scenario: Reuse cached clone
    Given URL "https://github.com/axios/axios"
    And repo already exists at "~/.cache/github/axios"
    When I resolve the repo
    Then no git clone should be executed
    And local_path should be "~/.cache/github/axios"

  Scenario: Custom cache directory
    Given URL "https://github.com/axios/axios"
    And cache_dir "./repo-cache"
    When I resolve the repo
    Then repo should be cloned to "./repo-cache/axios"

  Scenario: Clone failure
    Given invalid URL "https://github.com/nonexistent/repo12345"
    When I try to resolve the repo
    Then a clear error should be raised
    And error should mention clone failure

  Scenario: Cleanup temporary repo
    Given a temporarily cloned repo
    When I call cleanup_repo
    Then the directory should be removed
```

## Implementation Notes

- Use `subprocess` to run `git clone`
- Shallow clone (`--depth 1`) for faster cloning
- Extract repo name from URL for target directory
- **Cache check**: Skip clone if `cache_dir/repo_name` already exists
- Expand `~` in cache path with `Path.expanduser()`
- Check for `git` availability

```python
def clone_repo(url: str, cache_dir: Path) -> Path:
    repo_name = url.rstrip('/').split('/')[-1].replace('.git', '')
    cache_path = Path(cache_dir).expanduser()
    clone_path = cache_path / repo_name

    # Reuse cached clone if exists
    if clone_path.exists():
        return clone_path

    cache_path.mkdir(parents=True, exist_ok=True)

    result = subprocess.run(
        ["git", "clone", "--depth", "1", url, str(clone_path)],
        capture_output=True,
        text=True
    )

    if result.returncode != 0:
        raise CloneError(f"Failed to clone {url}: {result.stderr}")

    return clone_path
```
