# Task 3 â€” Summaries Map/Reduce + Validation (Sequential Plan)

## Scope
- Implement DSPy map (chunk/file) and reduce (module/package) summarization with citation enforcement.
- Add validation: ensure citations are present, well-formed (`path:start-end`), and refer to existing chunks; optionally grade confidence.
- Persist summaries with confidence and citations.

## Deliverables
- DSPy modules wired into the pipeline for file and module/package summaries.
- Citation attachment per summary (at least one `path:start-end` per summary).
- Validation step that checks citation format and existence in the store; rejects/repairs invalid summaries.

## Implementation Plan
- Add a `validate_summary` function to parse citations, check chunk existence, and ensure non-empty text.
- Update summarization to attach citations deterministically (existing chunk ranges) and/or via LLM output when available.
- Fail fast on validation errors; log/retry as needed.

## Test Plan
- Unit: validation rejects malformed/missing citations; accepts valid `path:start-end` pointing to stored chunks.
- Unit/Integration: summarizing a file produces a summary with citations that resolve to chunks; validation passes.
- Integration: module summary aggregates child summaries and retains/derives citations; validation passes.
- Negative: introduce an invalid citation and assert validation fails.
