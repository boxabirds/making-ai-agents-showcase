# Task 20 — Schema/Store Hardening & Lifecycle Guard

Status: TODO

## Scope
- Add foreign keys for `summaries.target_id` to files/modules/packages and for module→package/file linkage so summaries cannot point to missing targets.
- Enforce uniqueness/primary keys for edges (src,dst,edge_type) and modules/packages; keep embeddings tied to symbols/chunks with constraints.
- Persist retrieval sets/issue lists/iteration metadata in the store for auditability; expose via store/audit CLI.
- Guard store lifecycle to prevent reuse across runs unless explicitly allowed (fail fast if a non-ephemeral path already exists).

## Deliverables
- Schema updates with FKs, unique indexes, and constraints; migrations or rebuild logic as needed.
- Store lifecycle changes preventing accidental DB reuse and documenting persisted audit artifacts.
- Audit CLI extensions to surface stored retrieval sets/issues.

## Test Plan
- Unit: inserting summaries with nonexistent targets fails; embedding rows require matching symbols/chunks.
- Unit: edge uniqueness enforced; duplicate inserts rejected.
- Unit: store initialization fails on existing non-ephemeral path unless override flag set.
- Integration: audit CLI lists retrieval/issue artifacts from a sample run.
