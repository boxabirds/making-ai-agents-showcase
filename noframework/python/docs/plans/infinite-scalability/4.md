# Task 4 â€” Retrieval Engine (FTS, Hybrid) & Store API

## Scope
- Implement deterministic-first retrieval over SQLite: path/lang filters, symbol lookup, graph neighbors, FTS5 search.
- Optional embedding retrieval with lexical/graph re-rank; enforce overlap threshold.
- Provide store API/tool methods for retrieval (Pydantic-validated).

## Deliverables
- Retrieval module(s) encapsulating query plans and limits.
- Store API functions used by DSPy modules and CLI tools.

## Test Plan
- Unit: FTS queries return expected chunks; symbol lookup regex/exact cases; graph neighbor queries.
- Unit: embedding path (if enabled) returns candidates re-ranked by lexical overlap; low-overlap items dropped.
- Integration: retrieval for topic pulls expected chunks/summaries/edges in bounded count.
- Property: retrieval bounded (no unbounded result sets), deterministic ordering given same inputs.
- Error handling: missing indices or empty results -> return explicit errors or empty results; validation errors surfaced.
