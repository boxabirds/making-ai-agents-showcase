# Task 2: Structural Validation

## Design Reference
- [tech-design.md ยง3.2.2](../../design/citation-eval/tech-design.md#322-stage-2-structural-validation)

## Objective
Validate that citations resolve to actual cached content with valid line ranges.

## Requirements

### R2.1: File Existence Check
Verify cited file exists in the CacheStore

### R2.2: Line Range Validation
- start_line >= 1
- end_line >= start_line
- end_line <= file line count

### R2.3: Content Extraction
For valid citations, extract the cited lines

### R2.4: Error Reporting
For invalid citations, return specific error message per tech-design.md ยง3.2.2 table

## Dependencies
- Task 1: Citation extraction

## Test Plan

| Test | Input | Expected |
|------|-------|----------|
| Valid citation | File exists, lines in range | `valid=True`, content returned |
| File not cached | Citation to uncached file | `valid=False`, "File not in cache" |
| Line out of range | `[a.py:100-200]` on 50-line file | `valid=False`, "Line out of range" |
| Invalid range | `[a.py:10-5]` | `valid=False`, "End before start" |
| Binary file | Citation to image/binary | `valid=False`, "Binary file" |

## Acceptance Criteria
- [ ] All error conditions from tech-design.md ยง3.2.2 handled
- [ ] Valid citations return extracted content
- [ ] Works with existing CacheStore API
- [ ] Performance: O(1) per citation (hash lookup)
