# Task 9: Aggregation & Metrics

## Design Reference
- [tech-design.md §3.2.6](../../design/citation-eval/tech-design.md#326-stage-5-aggregation)
- [tech-design.md §8.6](../../design/citation-eval/tech-design.md#86-evalresult)

## Objective
Compute final metrics from verification results.

## Requirements

### R9.1: Validity Rate
`valid_citations / total_citations`

### R9.2: Precision Metrics
Per tech-design.md §3.2.6:
- Extractive precision: `extractive_supports / extractive_total`
- Abstractive precision: `abstractive_supports / abstractive_total`
- Overall precision: `all_supports / all_checked`

### R9.3: Coverage
`cited_claims / total_claims`

### R9.4: Cost Metrics
- LLM calls made
- Total tokens used

### R9.5: Threshold Comparison
Compare metrics against thresholds from tech-design.md §9.1

## Dependencies
- Task 8: Pipeline orchestration (provides raw results)

## Test Plan

| Test | Input | Expected |
|------|-------|----------|
| Perfect score | All valid, all support | validity=1.0, precision=1.0 |
| Mixed results | 8/10 valid, 6/8 support | validity=0.8, precision=0.75 |
| No abstractive | Only extractive claims | abstractive_precision=N/A |
| Threshold pass | precision > 0.8 | passed=True |
| Threshold fail | precision < 0.8 | passed=False, failure message |

## Acceptance Criteria
- [ ] All metrics from tech-design.md §3.2.6 computed
- [ ] Division by zero handled (N/A for empty categories)
- [ ] Threshold comparison configurable
- [ ] `EvalResult` structure matches tech-design.md §8.6
