# Task 5: Extractive Verification

## Design Reference
- [tech-design.md §4](../../design/citation-eval/tech-design.md#4-extractive-verification-design)
- [tech-design.md §3.2.4](../../design/citation-eval/tech-design.md#324-stage-4a-extractive-verification)

## Objective
Verify extractive claims by checking if key terms from the claim appear in cited code.

## Requirements

### R5.1: Term Extraction from Claims
Extract verifiable terms:
- Code spans (backtick content)
- Identifiers (CamelCase, snake_case)
- Exclude common words ("function", "class", "the")

### R5.2: Term Matching in Code
Check if extracted terms appear in cited code:
- Exact match for identifiers
- Case-insensitive for prose
- Fuzzy match for near-typos (Levenshtein ≤ 2)

### R5.3: Scoring
Per tech-design.md §4.4:
- ≥80% terms found → SUPPORTS
- ≥50% terms found → PARTIAL
- <50% terms found → NOT_SUPPORTS

### R5.4: Output
Return `VerificationResult` with matched terms list

## Dependencies
- Task 4: Claim classification (identifies extractive claims)

## Test Plan

| Test | Claim | Code | Expected |
|------|-------|------|----------|
| All terms match | "The `validate` function" | `def validate():` | SUPPORTS |
| Partial match | "The `auth` module handles login" | `def auth():` (no login) | PARTIAL |
| No match | "Uses Redis caching" | `db.query()` | NOT_SUPPORTS |
| Fuzzy match | "The `valdiate` function" (typo) | `def validate():` | SUPPORTS |
| Case insensitive | "The USER model" | `class User:` | SUPPORTS |

## Acceptance Criteria
- [ ] Term extraction handles code spans and identifiers
- [ ] Matching algorithm per tech-design.md §4.2
- [ ] Scoring thresholds configurable
- [ ] No LLM calls (deterministic)
- [ ] Performance: O(terms × code_length)
