# Task 10: CLI Integration

## Design Reference
- [tech-design.md ยง15.7](../../design/citation-eval/tech-design.md#157-output-modes)
- [eval.md ยง CLI Integration](../eval.md)

## Objective
Add evaluation and correction flags to tech_writer CLI.

## Requirements

### R10.1: Eval Flag
`--eval` runs evaluation after report generation

### R10.2: Eval Mode Options
- `--eval-structural`: Run only structural checks (no LLM)
- `--eval-full`: Run full evaluation including LLM judge

### R10.3: Correction Flags
Per tech-design.md ยง15.7:
- `--correct`: Run correction workflow after evaluation
- `--strict`: Fail (exit 2) if any citations remain unfixed after correction

> **Note:** No threshold override flags. Target is 100% citation accuracy.
> Any failure triggers correction workflow (see ยง15.1).

### R10.4: Output Format
- Default: Human-readable to stderr
- `--eval-json`: Machine-readable JSON output (includes failed_citations)
- Exit codes: 0=success (100% valid), 1=error, 2=failures remain after correction

### R10.5: Cost Reporting
Show LLM calls and tokens used (evaluation + correction)

## Dependencies
- Task 9: Aggregation (provides `EvalResult`)
- Task 14: Correction workflow (for `--correct` flag)

## Test Plan

| Test | Command | Expected |
|------|---------|----------|
| Basic eval | `--eval` | Metrics + failed citations to stderr |
| Structural only | `--eval-structural` | No LLM calls |
| JSON output | `--eval --eval-json` | JSON with failed_citations list |
| With correction | `--eval --correct` | Iterates until 100% or limit |
| Strict mode | `--eval --correct --strict` | Exit 2 if any failures remain |
| Perfect report | `--eval` on valid report | Exit 0, no failures |

## Acceptance Criteria
- [ ] `--eval` flag works with report generation
- [ ] Failed citations output in human-readable and JSON formats
- [ ] `--correct` triggers correction workflow
- [ ] Exit codes: 0=100% valid, 1=error, 2=failures remain
- [ ] `--help` documents all eval options
