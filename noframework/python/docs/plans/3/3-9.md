# Task 3-9: Add BDD feature tests

## Reference

See `docs/designs/3/tech-design.md` Â§Testing

## Requirements

Create `tests/features/test_complexity_bdd.py`:

1. **Scenario: Automatic budget scaling**
   ```gherkin
   Given a simple codebase (Total CC < 5000)
   When I run tech_writer
   Then max_sections should be 10
   And max_exploration should be 100
   ```

2. **Scenario: Complex codebase gets larger budget**
   ```gherkin
   Given a complex codebase (Total CC > 100000)
   When I run tech_writer
   Then max_sections should be 50
   And max_exploration should be 800
   ```

3. **Scenario: Skip complexity analysis**
   ```gherkin
   When I run tech_writer with --skip-complexity
   Then complexity analysis should not run
   And default budgets should be used
   ```

4. **Scenario: Dry run mode**
   ```gherkin
   When I run tech_writer with --dry-run
   Then complexity metrics should be displayed
   And pipeline should not run
   ```

5. **Scenario: Graceful degradation**
   ```gherkin
   Given the complexity analyzer is unavailable
   When I run tech_writer
   Then default budgets should be used
   And a warning should be logged
   ```

## Testing Approach

- Use subprocess to run CLI
- Parse stderr for metrics
- Mock analyzer availability for degradation test

## Acceptance Criteria

- [ ] All scenarios pass
- [ ] Tests are self-contained
- [ ] Graceful skip when dependencies unavailable
