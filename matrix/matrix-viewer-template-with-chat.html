<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Writer Implementation Comparison Matrix</title>
    
    <!-- Highlight.js CSS - GitHub theme for clean code display -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/github.min.css">
    
    <!-- Highlight.js core library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
    
    <!-- Highlight.js Python language support -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/python.min.js"></script>
    
    <!-- Line numbers plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
    
    <style>
        /* Line number styling for highlight.js */
        .hljs-ln {
            width: 100%;
        }
        
        .hljs-ln-numbers {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            text-align: right;
            color: #999;
            border-right: 1px solid #ddd;
            vertical-align: top;
            padding-right: 10px !important;
            padding-left: 5px !important;
            width: 50px;
            white-space: nowrap;
        }

        .hljs-ln-code {
            padding-left: 15px !important;
        }
        
        /* Override highlight.js styles for our layout */
        .code-content pre {
            margin: 0;
            padding: 0;
            background: transparent;
            overflow: visible;
        }
        
        .code-content code {
            font-family: var(--font-mono);
            font-size: 0.875rem;
            line-height: 1.5;
            background: transparent;
            padding: 0;
        }
        
        /* Highlight blocks for comparison */
        .hljs-ln-line.highlighted {
            background-color: var(--highlight-color) !important;
            transition: background-color 0.3s ease;
        }
        
        .hljs-ln-line {
            display: table-row;
        }
        
        /* Fix table display for proper highlighting */
        .hljs-ln tbody {
            display: table-row-group;
        }
        
        .hljs-ln tr {
            display: table-row;
        }
        
        .hljs-ln td {
            display: table-cell;
        }
    </style>
    
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --accent-color: #0066cc;
            --winner-color: #28a745;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --font-mono: 'SF Mono', Monaco, Consolas, 'Courier New', monospace;
            --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-sans);
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 2rem;
        }

        h1 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 2rem;
            text-align: center;
        }

        /* Matrix View */
        .matrix-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-sm);
            overflow: auto;
            max-height: 100%;
        }

        .matrix-grid {
            display: grid;
            gap: 1px;
            background: var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        .matrix-cell {
            background: var(--bg-primary);
            padding: 0.33rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.7rem;
            position: relative;
            border: 2px solid transparent;
        }

        .matrix-cell:hover {
            background: var(--bg-tertiary);
            transform: scale(1.02);
            box-shadow: var(--shadow-sm);
            z-index: 1;
        }

        .matrix-cell.selected {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            font-weight: 600;
        }

        .matrix-cell.selected:hover {
            background: #0052a3;
            transform: scale(1.05);
        }

        .matrix-cell.header {
            background: var(--bg-tertiary);
            font-weight: 600;
            cursor: default;
        }

        .matrix-cell.header:hover {
            transform: none;
            box-shadow: none;
        }

        .matrix-cell.disabled {
            background: var(--bg-secondary);
            cursor: default;
            opacity: 0.5;
        }

        .matrix-cell.disabled:hover {
            transform: none;
            box-shadow: none;
        }

        /* Comparison Panel */
        .comparison-panel {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-sm);
            display: none;
        }

        .comparison-panel.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .comparison-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .comparison-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .winner-badge {
            background: var(--winner-color);
            color: white;
            padding: 0.25rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .comparison-summary {
            margin-bottom: 2rem;
            line-height: 1.8;
            color: var(--text-secondary);
        }

        .pros-cons-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .vendor-section {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
        }

        .vendor-name {
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--accent-color);
        }

        .suitability {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            font-style: italic;
        }

        .pros-list, .cons-list {
            list-style: none;
            padding: 0;
        }

        .pros-list li, .cons-list li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .pros-list li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: var(--winner-color);
            font-weight: bold;
        }

        .cons-list li::before {
            content: "√ó";
            position: absolute;
            left: 0;
            color: #dc3545;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .view-code-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .view-code-btn:hover {
            background: #0052a3;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Code Browser */
        .code-browser {
            height: 50%;
            background: var(--bg-secondary);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            display: grid;
            grid-template-columns: 1fr 400px 1fr;
            gap: 1px;
            background: var(--border-color);
        }

        .code-panel {
            background: var(--bg-primary);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .code-header {
            background: var(--bg-tertiary);
            padding: 1rem;
            font-weight: 600;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        .code-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: auto;
            padding: 1rem;
            background: #f8f8f8;
        }

        .comparison-list {
            background: var(--bg-secondary);
            overflow-y: auto;
            padding: 1rem;
        }

        .block-comparison {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .block-comparison:hover {
            box-shadow: var(--shadow-sm);
            transform: translateX(-2px);
        }

        .block-comparison.active {
            border-left: 4px solid var(--accent-color);
            box-shadow: var(--shadow-md);
        }

        .block-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .block-details {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .block-comparison-text {
            font-size: 0.875rem;
            line-height: 1.5;
        }

        /* Layout Structure */
        .main-layout {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 6rem);
            gap: 1rem;
        }

        .top-row {
            display: flex;
            gap: 0;
            height: 45%;
            min-height: 400px;
            position: relative;
        }

        .matrix-section {
            flex: 0 0 30%;
            min-width: 250px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .details-section {
            flex: 0 0 40%;
            min-width: 300px;
            overflow: auto;
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 2rem;
        }
        
        .chat-section {
            flex: 0 0 30%;
            min-width: 350px;
        }

        /* Draggable separators */
        .separator {
            width: 8px;
            background: #c5c9cd;
            cursor: col-resize;
            position: relative;
            transition: background 0.2s;
            border-left: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
        }

        .separator:hover {
            background: var(--accent-color);
        }

        .separator::after {
            content: '‚ãÆ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #666;
            font-size: 1.2rem;
        }

        .separator-horizontal {
            height: 8px;
            width: 100%;
            background: #c5c9cd;
            cursor: row-resize;
            position: relative;
            transition: background 0.2s;
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
        }

        .separator-horizontal:hover {
            background: var(--accent-color);
        }

        .separator-horizontal::after {
            content: '‚ãØ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #666;
            font-size: 1.2rem;
            letter-spacing: 2px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .code-browser.active {
                grid-template-columns: 1fr 300px 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .pros-cons-grid {
                grid-template-columns: 1fr;
            }
            
            .code-browser.active {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
            }
            
            .comparison-list {
                order: -1;
                max-height: 200px;
            }
        }


        .chat-panel {
            height: 100%;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            border-radius: 12px;
            overflow: hidden;
        }

        /* Chat Header */
        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            flex-shrink: 0;
        }

        .chat-header h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin: 0;
        }

        .chat-header p {
            font-size: 0.75rem;
            opacity: 0.9;
            margin: 4px 0 0 0;
        }

        /* Messages Area */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background-color: #f9f9f9;
        }

        .message {
            display: flex;
            gap: 10px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 15px;
            font-size: 14px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background-color: #667eea;
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.assistant .message-content {
            background-color: white;
            color: #333;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 5px;
        }

        /* Avatar */
        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }

        .message.user .avatar {
            background-color: #e0e0e0;
            color: #666;
            order: 1;
        }

        .message.assistant .avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            padding: 20px;
            justify-content: flex-start;
        }

        .typing-indicator.active {
            display: flex;
        }

        .typing-bubble {
            background-color: white;
            border: 1px solid #e0e0e0;
            padding: 12px 20px;
            border-radius: 15px;
            border-bottom-left-radius: 5px;
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #666;
            border-radius: 50%;
            animation: typing 1.4s ease-in-out infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.5;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* Input Area */
        .input-container {
            padding: 20px;
            background-color: white;
            border-top: 1px solid #e0e0e0;
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }

        .chat-input:focus {
            border-color: #667eea;
        }

        .send-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .send-button:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .send-button svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        /* Welcome Message */
        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .welcome-message h4 {
            color: #333;
            margin-bottom: 10px;
        }

        .quick-questions {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quick-question {
            background-color: white;
            border: 1px solid #e0e0e0;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 13px;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-question:hover {
            background-color: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>Tech Writer Implementation Comparison</h1>
        
        <div class="main-layout">
            <!-- Top row: Matrix, Comparison Details, and Chat -->
            <div class="top-row">
                <div class="matrix-section">
                    <div class="matrix-container">
                        <div id="matrix-grid" class="matrix-grid"></div>
                    </div>
                </div>
                
                <div class="separator" id="separator1"></div>
                
                <div class="details-section">
                    <div id="empty-state" style="text-align: center; padding: 4rem 2rem; color: var(--text-secondary);">
                        <h2 style="margin-bottom: 1rem;">Select Two Frameworks to Compare</h2>
                        <p>Click on any ‚öñÔ∏è cell in the matrix to see a detailed comparison</p>
                    </div>
                    
                    <div id="comparison-details" style="display: none;">
                        <div class="comparison-header">
                            <h2 class="comparison-title" id="comparison-title"></h2>
                            <span class="winner-badge" id="winner-badge"></span>
                        </div>
                        
                        <p class="comparison-summary" id="comparison-summary"></p>
                        
                        <div class="pros-cons-grid">
                            <div class="vendor-section">
                                <h3 class="vendor-name" id="vendor-a-name"></h3>
                                <p class="suitability" id="vendor-a-suitability"></p>
                                <h4>Pros</h4>
                                <ul class="pros-list" id="vendor-a-pros"></ul>
                                <h4 style="margin-top: 1rem;">Cons</h4>
                                <ul class="cons-list" id="vendor-a-cons"></ul>
                            </div>
                            
                            <div class="vendor-section">
                                <h3 class="vendor-name" id="vendor-b-name"></h3>
                                <p class="suitability" id="vendor-b-suitability"></p>
                                <h4>Pros</h4>
                                <ul class="pros-list" id="vendor-b-pros"></ul>
                                <h4 style="margin-top: 1rem;">Cons</h4>
                                <ul class="cons-list" id="vendor-b-cons"></ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="separator" id="separator2"></div>
                
                <div class="chat-section">
                    <div class="chat-panel">
                        
                        <div class="messages-container" id="messagesContainer">
                            <div class="welcome-message">
                                <h4>Welcome! üëã</h4>
                                <p>Here you can explore how a tech writer agent was implemented in a range of frameworks.</p>
                                <div class="quick-questions">
                                    <div class="quick-question" onclick="window.chatWidget.sendQuickQuestion('What\'s the simplest implementation available?')">
                                        What's the simplest implementation?
                                    </div>
                                    <div class="quick-question" onclick="window.chatWidget.sendQuickQuestion('Which framework offers the best type safety?')">
                                        Which has the best type safety?
                                    </div>
                                    <div class="quick-question" onclick="window.chatWidget.sendQuickQuestion('Compare LangGraph and Pydantic-AI')">
                                        Compare LangGraph vs Pydantic-AI
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="typing-indicator" id="typingIndicator">
                            <div class="typing-bubble">
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                            </div>
                        </div>
                        
                        <div class="input-container">
                            <div class="input-wrapper">
                                <input 
                                    type="text" 
                                    class="chat-input" 
                                    id="chatInput" 
                                    placeholder="Ask about tech writer implementations..."
                                    autocomplete="off"
                                    autofocus
                                >
                                <button class="send-button" id="sendButton">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M2 21l21-9L2 3v7l15 2-15 2v7z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="separator-horizontal" id="separator-horizontal"></div>
            
            <!-- Bottom row: Code Browser -->
            <div id="code-browser" class="code-browser">
                <div class="code-panel">
                    <div class="code-header" id="code-header-a">Select a comparison</div>
                    <div class="code-content" id="code-content-a">
                        <div id="code-empty-a" style="padding: 20px; color: #666; text-align: center;">
                            <p>Select two frameworks to compare</p>
                        </div>
                    </div>
                </div>
                
                <div class="comparison-list" id="comparison-list">
                    <div id="comparison-empty" style="padding: 20px; color: #666; text-align: center;">
                        <p>Code comparisons will appear here</p>
                    </div>
                </div>
                
                <div class="code-panel">
                    <div class="code-header" id="code-header-b">Select a comparison</div>
                    <div class="code-content" id="code-content-b">
                        <div id="code-empty-b" style="padding: 20px; color: #666; text-align: center;">
                            <p>Select two frameworks to compare</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        // Matrix data will be injected here
        const matrixData = /* MATRIX_DATA_PLACEHOLDER */;
        
        // Code content will be injected here
        const codeFiles = /* CODE_FILES_PLACEHOLDER */;
        
        // Color palette for block mappings
        const blockColors = [
            '#e3f2fd', '#f3e5f5', '#e8f5e9', '#fff3e0', '#fce4ec',
            '#e0f2f1', '#f1f8e9', '#ede7f6', '#e0f7fa', '#fff8e1'
        ];
        
        let currentComparison = null;
        let currentView = 'matrix';
        let codeElements = {}; // Store highlighted code elements
        
        // Initialize the app
        function init() {
            console.log('Initializing app...');
            console.log('Matrix data:', matrixData);
            console.log('Code files:', Object.keys(codeFiles));
            
            buildMatrix();
            setupEventListeners();
            setupDraggableSeparator();
        }
        
        // Setup draggable separators
        function setupDraggableSeparator() {
            // First vertical separator (between matrix and details)
            const separator1 = document.getElementById('separator1');
            const separator2 = document.getElementById('separator2');
            const topRow = document.querySelector('.top-row');
            const matrixSection = document.querySelector('.matrix-section');
            const detailsSection = document.querySelector('.details-section');
            const chatSection = document.querySelector('.chat-section');
            
            let isResizing1 = false;
            let isResizing2 = false;
            
            separator1.addEventListener('mousedown', (e) => {
                isResizing1 = true;
                document.body.style.cursor = 'col-resize';
                e.preventDefault();
            });
            
            separator2.addEventListener('mousedown', (e) => {
                isResizing2 = true;
                document.body.style.cursor = 'col-resize';
                e.preventDefault();
            });
            
            // Horizontal separator
            const separatorHorizontal = document.getElementById('separator-horizontal');
            const mainLayout = document.querySelector('.main-layout');
            const codeBrowser = document.getElementById('code-browser');
            
            let isResizingHorizontal = false;
            
            separatorHorizontal.addEventListener('mousedown', (e) => {
                isResizingHorizontal = true;
                document.body.style.cursor = 'row-resize';
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isResizing1) {
                    const containerRect = topRow.getBoundingClientRect();
                    const matrixWidth = e.clientX - containerRect.left;
                    const totalWidth = containerRect.width;
                    const matrixPercent = (matrixWidth / totalWidth) * 100;
                    
                    if (matrixPercent > 15 && matrixPercent < 50) {
                        matrixSection.style.flex = `0 0 ${matrixPercent}%`;
                        // Recalculate remaining space for details and chat
                        const remaining = 100 - matrixPercent;
                        const detailsPercent = remaining * 0.5;
                        const chatPercent = remaining * 0.5;
                        detailsSection.style.flex = `0 0 ${detailsPercent}%`;
                        chatSection.style.flex = `0 0 ${chatPercent}%`;
                    }
                } else if (isResizing2) {
                    const containerRect = topRow.getBoundingClientRect();
                    const sep2Rect = separator2.getBoundingClientRect();
                    const detailsWidth = sep2Rect.left - containerRect.left - matrixSection.offsetWidth - separator1.offsetWidth;
                    const totalWidth = containerRect.width;
                    const detailsPercent = (detailsWidth / totalWidth) * 100;
                    
                    const matrixPercent = (matrixSection.offsetWidth / totalWidth) * 100;
                    const remaining = 100 - matrixPercent;
                    
                    if (detailsPercent > 15 && detailsPercent < remaining - 15) {
                        detailsSection.style.flex = `0 0 ${detailsPercent}%`;
                        chatSection.style.flex = `0 0 ${remaining - detailsPercent}%`;
                    }
                } else if (isResizingHorizontal) {
                    const containerTop = mainLayout.getBoundingClientRect().top;
                    const containerHeight = mainLayout.getBoundingClientRect().height;
                    const newTopHeight = e.clientY - containerTop;
                    const topPercent = (newTopHeight / containerHeight) * 100;
                    const bottomPercent = 100 - topPercent;
                    
                    if (topPercent > 20 && topPercent < 80) {
                        topRow.style.height = `${topPercent}%`;
                        codeBrowser.style.height = `${bottomPercent}%`;
                    }
                }
            });
            
            document.addEventListener('mouseup', () => {
                isResizing1 = false;
                isResizing2 = false;
                isResizingHorizontal = false;
                document.body.style.cursor = 'default';
            });
        }
        
        function buildMatrix() {
            const vendors = getUniqueVendors();
            const grid = document.getElementById('matrix-grid');
            const gridSize = vendors.length + 1;
            
            grid.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
            grid.style.gridTemplateRows = `repeat(${gridSize}, 1fr)`;
            
            // Empty top-left cell
            const emptyCell = document.createElement('div');
            emptyCell.className = 'matrix-cell header';
            grid.appendChild(emptyCell);
            
            // Column headers
            vendors.forEach(vendor => {
                const cell = document.createElement('div');
                cell.className = 'matrix-cell header';
                cell.textContent = vendor;
                grid.appendChild(cell);
            });
            
            // Rows
            vendors.forEach(vendorA => {
                // Row header
                const rowHeader = document.createElement('div');
                rowHeader.className = 'matrix-cell header';
                rowHeader.textContent = vendorA;
                grid.appendChild(rowHeader);
                
                // Cells
                vendors.forEach(vendorB => {
                    const cell = document.createElement('div');
                    
                    if (vendorA === vendorB) {
                        cell.className = 'matrix-cell disabled';
                        cell.textContent = '‚Äî';
                    } else {
                        const comparison = findComparison(vendorA, vendorB);
                        if (comparison) {
                            cell.className = 'matrix-cell';
                            cell.textContent = '‚öñÔ∏è';
                            cell.dataset.vendorA = vendorA;
                            cell.dataset.vendorB = vendorB;
                            cell.onclick = () => showComparison(vendorA, vendorB);
                        } else {
                            cell.className = 'matrix-cell disabled';
                            cell.textContent = '¬∑';
                        }
                    }
                    
                    grid.appendChild(cell);
                });
            });
        }
        
        function getUniqueVendors() {
            const vendors = new Set();
            matrixData.comparisons.forEach(comp => {
                vendors.add(comp.vendor_a);
                vendors.add(comp.vendor_b);
            });
            return Array.from(vendors).sort();
        }
        
        function findComparison(vendorA, vendorB) {
            return matrixData.comparisons.find(comp => 
                (comp.vendor_a === vendorA && comp.vendor_b === vendorB) ||
                (comp.vendor_a === vendorB && comp.vendor_b === vendorA)
            );
        }
        
        function showComparison(vendorA, vendorB) {
            const comparison = findComparison(vendorA, vendorB);
            if (!comparison) return;
            
            currentComparison = comparison;
            
            // Clear previous selection
            document.querySelectorAll('.matrix-cell.selected').forEach(cell => {
                cell.classList.remove('selected');
            });
            
            // Mark current cell as selected
            const currentCell = document.querySelector(`.matrix-cell[data-vendor-a="${vendorA}"][data-vendor-b="${vendorB}"]`) ||
                               document.querySelector(`.matrix-cell[data-vendor-a="${vendorB}"][data-vendor-b="${vendorA}"]`);
            if (currentCell) {
                currentCell.classList.add('selected');
            }
            
            // Hide empty state, show comparison details
            document.getElementById('empty-state').style.display = 'none';
            document.getElementById('comparison-details').style.display = 'block';
            
            // Update comparison panel
            document.getElementById('comparison-title').textContent = `${vendorA} vs ${vendorB}`;
            document.getElementById('winner-badge').textContent = `Winner: ${comparison.overall_winner.split(' ')[0]}`;
            document.getElementById('comparison-summary').textContent = comparison.summary;
            
            // Update vendor A
            document.getElementById('vendor-a-name').textContent = vendorA;
            document.getElementById('vendor-a-suitability').textContent = comparison.suitability[vendorA];
            updateList('vendor-a-pros', comparison.pros_cons[vendorA].pros);
            updateList('vendor-a-cons', comparison.pros_cons[vendorA].cons);
            
            // Update vendor B
            document.getElementById('vendor-b-name').textContent = vendorB;
            document.getElementById('vendor-b-suitability').textContent = comparison.suitability[vendorB];
            updateList('vendor-b-pros', comparison.pros_cons[vendorB].pros);
            updateList('vendor-b-cons', comparison.pros_cons[vendorB].cons);
            
            // Automatically load code comparison
            loadCodeComparison(comparison);
        }
        
        function updateList(id, items) {
            const list = document.getElementById(id);
            list.innerHTML = items.map(item => `<li>${item}</li>`).join('');
        }
        
        
        function loadCodeComparison(comparison) {
            console.log('Loading comparison:', comparison.vendor_a, 'vs', comparison.vendor_b);
            
            // Set headers
            document.getElementById('code-header-a').textContent = comparison.vendor_a;
            document.getElementById('code-header-b').textContent = comparison.vendor_b;
            
            // Load code
            const codeA = codeFiles[comparison.vendor_a];
            const codeB = codeFiles[comparison.vendor_b];
            
            console.log('Code A length:', codeA ? codeA.length : 'undefined');
            console.log('Code B length:', codeB ? codeB.length : 'undefined');
            
            if (codeA && codeB) {
                renderCode('code-content-a', codeA, comparison.vendor_a);
                renderCode('code-content-b', codeB, comparison.vendor_b);
                renderComparisons(comparison);
            } else {
                console.error('Missing code files:', !codeA ? comparison.vendor_a : '', !codeB ? comparison.vendor_b : '');
            }
        }
        
        function renderCode(elementId, code, vendor) {
            const element = document.getElementById(elementId);
            if (!element) {
                console.error('Element not found:', elementId);
                return;
            }
            
            // Hide empty state
            const emptyStateId = elementId.replace('code-content-', 'code-empty-');
            const emptyState = document.getElementById(emptyStateId);
            if (emptyState) {
                emptyState.style.display = 'none';
            }
            
            // Create pre and code elements for highlight.js
            const pre = document.createElement('pre');
            const codeEl = document.createElement('code');
            codeEl.className = 'language-python';
            codeEl.textContent = code;
            pre.appendChild(codeEl);
            
            // Clear existing content and add new
            element.innerHTML = '';
            element.appendChild(pre);
            
            // Apply syntax highlighting
            hljs.highlightElement(codeEl);
            
            // Add line numbers
            hljs.lineNumbersBlock(codeEl, {
                singleLine: true,
                startFrom: 1
            });
            
            // Store the code element for later highlighting
            codeElements[vendor] = codeEl;
        }
        
        function renderComparisons(comparison) {
            const list = document.getElementById('comparison-list');
            
            // Hide empty state
            const emptyState = document.getElementById('comparison-empty');
            if (emptyState) {
                emptyState.style.display = 'none';
            }
            
            list.innerHTML = comparison.block_mappings.map((mapping, index) => {
                const color = blockColors[index % blockColors.length];
                
                return `<div class="block-comparison" data-index="${index}" 
                         onclick="highlightBlocks(${index})"
                         style="--block-color: ${color};">
                    <div class="block-title">${mapping.description}</div>
                    <div class="block-comparison-text">${mapping.comparison}</div>
                </div>`;
            }).join('');
        }
        
        function highlightBlocks(index) {
            if (!currentComparison) return;
            
            const mapping = currentComparison.block_mappings[index];
            const color = blockColors[index % blockColors.length];
            
            // Clear previous highlights
            document.querySelectorAll('.hljs-ln-line').forEach(line => {
                line.classList.remove('highlighted');
                line.style.setProperty('--highlight-color', '');
            });
            
            // Clear previous active comparison
            document.querySelectorAll('.block-comparison').forEach(block => {
                block.classList.remove('active');
            });
            
            // Mark comparison as active
            document.querySelector(`[data-index="${index}"]`).classList.add('active');
            
            // Highlight and scroll vendor A
            highlightAndScroll(currentComparison.vendor_a, mapping.vendor_a.lines, color);
            
            // Highlight and scroll vendor B
            highlightAndScroll(currentComparison.vendor_b, mapping.vendor_b.lines, color);
        }
        
        function highlightAndScroll(vendor, lines, color) {
            const codeEl = codeElements[vendor];
            if (!codeEl) return;
            
            const [start, end] = lines;
            let firstHighlightedRow = null;
            
            // Find all line rows in the code element
            const lineRows = codeEl.querySelectorAll('.hljs-ln-line');
            
            lineRows.forEach((row, index) => {
                const lineNum = index + 1;
                if (lineNum >= start && lineNum <= end) {
                    row.classList.add('highlighted');
                    row.style.setProperty('--highlight-color', color);
                    
                    if (!firstHighlightedRow) {
                        firstHighlightedRow = row;
                    }
                }
            });
            
            // Scroll to first highlighted line
            if (firstHighlightedRow) {
                const container = codeEl.parentElement.parentElement;
                const rowTop = firstHighlightedRow.offsetTop;
                const containerHeight = container.clientHeight;
                const scrollPosition = rowTop - containerHeight / 3;
                
                container.scrollTo({
                    top: scrollPosition,
                    behavior: 'smooth'
                });
            }
        }
        
        
        function setupEventListeners() {
            // Add any additional event listeners here if needed
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', init);

        // Chat Widget Code
        // ===== CONFIGURATION =====
        const CONFIG = {
            WORKER_URL: 'https://tech-writer-ai-proxy.julian-harris.workers.dev',
            MODEL: 'gemini-2.0-flash',
            MAX_TOKENS: 1024,
            TEMPERATURE: 0.0
        };

        class ChatWidget {
            constructor() {
                this.messagesContainer = document.getElementById('messagesContainer');
                this.input = document.getElementById('chatInput');
                this.sendBtn = document.getElementById('sendButton');
                this.typingIndicator = document.getElementById('typingIndicator');
                
                this.conversationHistory = [];
                this.isProcessing = false;
                this.hasInitialSystemPrompt = false;
                
                this.init();
            }

            init() {
                // Event listeners
                this.sendBtn.addEventListener('click', () => this.sendMessage());
                this.input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });
                
                // Set focus to input on load
                this.input.focus();
            }

            sendQuickQuestion(question) {
                this.input.value = question;
                this.sendMessage();
            }

            addMessage(text, role) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${role}`;
                
                const avatar = document.createElement('div');
                avatar.className = 'avatar';
                avatar.textContent = role === 'user' ? 'U' : 'AI';
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                contentDiv.innerHTML = this.formatMessage(text);
                
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(contentDiv);
                
                // Remove welcome message if it exists
                const welcomeMsg = this.messagesContainer.querySelector('.welcome-message');
                if (welcomeMsg) {
                    welcomeMsg.remove();
                }
                
                this.messagesContainer.appendChild(messageDiv);
                this.scrollToBottom();
            }

            formatMessage(text) {
                return text
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/`(.*?)`/g, '<code style="background: #f0f0f0; padding: 2px 4px; border-radius: 3px;">$1</code>')
                    .replace(/\n\n/g, '<br><br>')
                    .replace(/\n/g, '<br>');
            }

            showTypingIndicator() {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'message assistant';
                typingDiv.id = 'typingIndicator';
                
                const indicatorDiv = document.createElement('div');
                indicatorDiv.className = 'typing-indicator';
                indicatorDiv.style.cssText = 'display: inline-flex; align-items: center; padding: 12px 16px; background: white; border: 1px solid #e0e0e0; border-radius: 15px;';
                indicatorDiv.innerHTML = `
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                `;
                
                typingDiv.appendChild(indicatorDiv);
                this.messagesContainer.appendChild(typingDiv);
                this.scrollToBottom();
            }

            hideTypingIndicator() {
                const indicator = document.getElementById('typingIndicator');
                if (indicator) {
                    indicator.remove();
                }
            }

            scrollToBottom() {
                this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
            }

            async sendMessage() {
                const message = this.input.value.trim();
                if (!message || this.isProcessing) return;

                this.isProcessing = true;
                this.sendBtn.disabled = true;
                
                // Add user message
                this.addMessage(message, 'user');
                this.input.value = '';
                
                // Show typing indicator
                this.showTypingIndicator();

                try {
                    // Build conversation history for Gemini
                    const contents = this.buildContents(message);
                    
                    // Make API request
                    const response = await this.callGeminiAPI(contents);
                    
                    // Hide typing indicator
                    this.hideTypingIndicator();
                    
                    // Add response
                    this.addMessage(response, 'assistant');
                    
                    // Update conversation history
                    this.conversationHistory.push(
                        { role: 'user', content: message },
                        { role: 'assistant', content: response }
                    );
                    
                } catch (error) {
                    this.hideTypingIndicator();
                    this.addMessage(`Sorry, I encountered an error: ${error.message}`, 'assistant');
                    console.error('Chat error:', error);
                } finally {
                    this.isProcessing = false;
                    this.sendBtn.disabled = false;
                    this.input.focus();
                }
            }

            buildContents(currentMessage) {
                const contents = [];
                
                // Build system prompt using the already-loaded matrixData
                const systemPrompt = `You are a tech writer agent support agent. You host an app that helps a user compare implementations of a tech writer agent using various different open source python packages. You respond to the questions in a tone of voice profile as defined below, in response to the tech writer agent data provided, also below. Regarding answer content, as a chatbot your answers are incredibly accurate, concise and to the point.

<tech-writer-comparison>
${JSON.stringify(matrixData, null, 2)}
</tech-writer-comparison>

<tone-profile>
You are helpful, knowledgeable, and concise. You provide direct answers without unnecessary elaboration. When comparing implementations, you focus on practical differences that matter to developers. You avoid marketing speak and stick to factual comparisons based on the data provided.
</tone-profile>

Remember: Always base your answers on the comparison data provided above. Be accurate and specific when referencing implementation details, line counts, and feature comparisons.`;
                
                // ALWAYS include system prompt at the beginning
                contents.push({
                    role: "user",
                    parts: [{ text: systemPrompt }]
                });
                contents.push({
                    role: "model", 
                    parts: [{ text: "I understand. I'm ready to help you choose the best Python package for your AI-powered documentation needs." }]
                });
                
                // Add conversation history
                this.conversationHistory.forEach(msg => {
                    contents.push({
                        role: msg.role === 'user' ? 'user' : 'model',
                        parts: [{ text: msg.content }]
                    });
                });
                
                // Add current message
                contents.push({
                    role: "user",
                    parts: [{ text: currentMessage }]
                });
                
                return contents;
            }

            async callGeminiAPI(contents) {
                const response = await fetch(CONFIG.WORKER_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: CONFIG.MODEL,
                        contents: contents,
                        generationConfig: {
                            temperature: CONFIG.TEMPERATURE,
                            maxOutputTokens: CONFIG.MAX_TOKENS
                        }
                    })
                });

                const data = await response.json();
                
                // Check if the response contains an error
                if (data.error) {
                    // Handle specific error cases with user-friendly messages
                    if (data.error.code === 503 || data.error.status === 'UNAVAILABLE') {
                        throw new Error('The AI model is currently overloaded. Please try again in a few moments.');
                    } else if (data.error.code === 429) {
                        throw new Error('Too many requests. Please wait a moment before trying again.');
                    } else if (data.error.message) {
                        throw new Error(data.error.message);
                    } else {
                        throw new Error('An unexpected error occurred. Please try again.');
                    }
                }
                
                // Check if the response has the expected structure
                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content || !data.candidates[0].content.parts || !data.candidates[0].content.parts[0]) {
                    throw new Error('Received an invalid response from the AI model. Please try again.');
                }
                
                return data.candidates[0].content.parts[0].text;
            }
        }

        // Initialize chat widget when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            window.chatWidget = new ChatWidget();
        });
    </script>
</body>
</html>